var egret=window.egret,utils=function(){var e={};return e.array2arraybuffer=function(e){for(var r=new ArrayBuffer(e.length),n=new DataView(r,0),t=0;t<e.length;t++)n.setUint8(t,e[t]);return r},e.arraybuffer2array=function(e){for(var r=new DataView(e,0),n=new Array,t=0;t<r.byteLength;t++)n[t]=r.getUint8(t);return n},e.string2utf8=function(e){for(var r=[],n=0,t=0;t<e.length;t++){var a=e.charCodeAt(t);a>=0&&127>=a?(n+=1,r.push(a)):a>=128&&2047>=a?(n+=2,r.push(192|31&a>>6),r.push(128|63&a)):(a>=2048&&55295>=a||a>=57344&&65535>=a)&&(n+=3,r.push(224|15&a>>12),r.push(128|63&a>>6),r.push(128|63&a))}for(t=0;t<r.length;t++)r[t]&=255;return r},e.utf82string=function(e){if("string"==typeof e)return null;for(var r="",n=0;n<e.length&&null!=e[n];n++){var t=e[n].toString(2),a=t.match(/^1+?(?=0)/);if(a&&8==t.length){for(var u=a[0].length,l=e[n].toString(2).slice(7-u),i=1;u>i;i++)l+=e[i+n].toString(2).slice(2);r+=String.fromCharCode(parseInt(l,2)),n+=u-1}else r+=String.fromCharCode(e[n])}return r},e.arrayconcat=function(e,r){for(var n=new Array,t=0;t<e.length;t++)n[t]=e[t];for(var a=e.length;a<e.length+r.length;a++)n[a]=r[a-e.length];return n},e}(),sproto=function(){function e(e){var r=e;return 0!=(2147483648&r)&&(r=0+(4294967295&r)),r}function r(e,r){var n=4294967296*(4294967295&r)+e;return n}function n(e,r){return Math.floor(e/Math.pow(2,r))}function t(e){return 255&e[0]|(255&e[1])<<8}function a(e){return(255&e[0]|(255&e[1])<<8|(255&e[2])<<16|(255&e[3])<<24)>>>0}function u(e){var r=a(e),n=0;for(e=e.slice(H);r>0;){var t;if(H>r)return-1;if(t=a(e),t+=H,t>r)return-1;++n,e=e.slice(t),r-=t}return n}function l(e,r){var n,u,l,i;if(H>r)return-1;if(u=t(e),l=J+K*u,l>r)return-1;for(n=e.slice(J),r-=l,e=e.slice(l),i=0;u>i;i++){var f,o=t(n.slice(i*K+J));if(0==o){if(H>r)return-1;if(f=a(e),H+f>r)return-1;e=e.slice(H+f),r-=H+f}}return u}function i(e,r){for(var n=a(r),t="",u=r.slice(H,H+n),l=0;l<u.length;l++)t+=String.fromCharCode(u[l]);return t}function f(e,r){if(0==r)return 1;var n=f(e*e,Math.floor(r/2));return 0!=(1&r)&&(n*=e),n}function o(e,r,n){var u,o,s,c=0,v=-1;if(r.tag=-1,r.type=-1,r.name=null,r.st=null,r.key=-1,r.extra=0,u=a(n),n=n.slice(H),o=n.slice(u),s=l(n,u),0>s)return null;n=n.slice(J);for(var p=0;s>p;p++){var g;if(++v,g=t(n.slice(K*p)),g&!0)v+=Math.floor(g/2);else if(0!=v){if(0==g)return null;switch(g=Math.floor(g/2)-1,v){case 1:if(g>=B)return null;r.type=g;break;case 2:if(r.type==Q)r.extra=f(10,g);else if(r.type==V)r.extra=g;else{if(g>=e.type_n)return null;if(r.type>=0)return null;r.type=B,r.st=g}break;case 3:r.tag=g;break;case 4:0!=g&&(c=G);break;case 5:r.key=g;break;default:return null}}else{if(0!=g)return null;r.name=i(e,n.slice(s*K))}}return r.tag<0||r.type<0||null==r.name?null:(r.type|=c,o)}function s(e,r,n){var f,s,c,v,p,g=a(n);if(n=n.slice(H),f=n.slice(g),s=l(n,g),0>=s||s>2)return null;for(var h=0;s*K>h;h+=K){var y=t(n.slice(J+h));if(0!=y)return null}if(r.name=null,r.n=0,r.base=0,r.maxn=0,r.f=null,n=n.slice(J+s*K),r.name=i(e,n),1==s)return f;if(n=n.slice(a(n)+H),c=u(n),0>c)return null;n=n.slice(H),v=c,p=-1,r.n=c,r.f=new Array;for(var h=0;c>h;h++){var d;r.f[h]=new Object;var b=r.f[h];if(n=o(e,b,n),null==n)return null;if(d=b.tag,p>=d)return null;d>p+1&&++v,p=d}return r.maxn=v,r.base=r.f[0].tag,c=r.f[c-1].tag-r.base+1,c!=r.n&&(r.base=-1),f}function c(e,r,n){var u,f,o,s;f=a(n),n=n.slice(H),u=n.slice(f),o=l(n,f),n=n.slice(J),r.name=null,r.tag=-1,r.p=new Array,r.p[D]=null,r.p[P]=null,r.confirm=0,s=0;for(var c=0;o>c;c++,s++){var v=t(n.slice(K*c));if(v&!0)s+=Math.floor(v-1)/2;else switch(v=Math.floor(v/2)-1,c){case 0:if(-1!=v)return null;r.name=i(e,n.slice(K*o));break;case 1:if(0>v)return null;r.tag=v;break;case 2:if(0>v||v>=e.type_n)return null;r.p[D]=e.type[v];break;case 3:if(0>v||v>e.type_n)return null;r.p[P]=e.type[v];break;case 4:r.confirm=v;break;default:return null}}return null==r.name||r.tag<0?null:u}function v(e,r,n){var i,f,o,v=l(r,n);if(0>v||v>2)return null;r=r.slice(J),i=r.slice(v*K);for(var p=0;v>p;p++){var g=t(r.slice(p*K));if(0!=g)return null;var h=u(i);if(0>h)return null;0==p?(f=i.slice(H),e.type_n=h,e.type=new Array):(o=i.slice(H),e.protocol_n=h,e.proto=new Array),i=i.slice(a(i)+H)}for(var p=0;p<e.type_n;p++)if(e.type[p]=new Object,f=s(e,e.type[p],f),null==f)return null;for(var p=0;p<e.protocol_n;p++)if(e.proto[p]=new Object,o=c(e,e.proto[p],o),null==o)return null;return e}function p(e){console.log(e)}function g(e,r){for(var n=0;n<e.protocol_n;n++)if(r==e.proto[n].name)return e.proto[n].tag;return-1}function h(e,r){for(var n=0,t=e.protocol_n;t>n;){var a=Math.floor((n+t)/2),u=e.proto[a].tag;if(u==r)return e.proto[a];r>u?n=a+1:t=a}return null}function y(e,r,n){var t=null;return 0>n||n>1?null:(t=h(e,r),t?t.p[n]:null)}function d(e,r){var n=h(e,r);return n?n.name:null}function b(e,r){for(var n=0;n<e.type_n;n++)if(r==e.type[n].name)return e.type[n];return null}function m(e,r){var n,t;if(e.base>=0)return r-=e.base,0>r||r>e.n?null:e.f[r];for(n=0,t=e.n;t>n;){var a=Math.floor((n+t)/2),u=e.f[a],l=u.tag;if(l==r)return u;r>l?n=a+1:t=a}return null}function k(e,r,n){return e[r]=255&n,e[r+1]=n>>8&255,e[r+2]=n>>16&255,e[r+3]=n>>24&255,n+H}function x(e,r,n,t){return r[n+4]=255&e,r[n+5]=e>>8&255,r[n+6]=e>>16&255,r[n+7]=e>>24&255,k(r,n,4)}function w(e,r,t,a){return r[t+4]=255&e,r[t+5]=255&n(e,8),r[t+6]=255&n(e,16),r[t+7]=255&n(e,24),r[t+8]=255&n(e,32),r[t+9]=255&n(e,40),r[t+10]=255&n(e,48),r[t+11]=255&n(e,56),k(r,t,8)}function _(e,r,n,t){var a;return r.buffer=n,r.buffer_idx=t+H,a=e(r),0>a?a==L?0:-1:k(n,t,a)}function j(e,r,n){e?(r[n+4]=255,r[n+5]=255,r[n+6]=255,r[n+7]=255):(r[n+4]=0,r[n+5]=0,r[n+6]=0,r[n+7]=0)}function O(e,r,n,t,a){var u,l,i=t;for(t++,u=4,l=1,a.value=0;;){var f;if(r.value=null,r.length=8,r.index=l,f=e(r),0>=f){if(f==L)break;if(f==z){a.value=1;break}return null}if(4==f){var o=r.value;n[t]=255&o,n[t+1]=o>>8&255,n[t+2]=o>>16&255,n[t+3]=o>>24&255,8==u&&j(2147483648&o,n,t)}else{var o;if(8!=f)return null;if(4==u){t+=4*(l-1);for(var s=l-2;s>=0;s--){for(var c,v=1+8*s;1+8*s+4>v;v++)header[v]=header[v-4*s];c=128&header[1+8*s+3],j(c,n,t+1+8*s)}u=8}o=value,n[t]=255&o,n[t+1]=o>>8&255,n[t+2]=o>>16&255,n[t+3]=o>>24&255,n[t+4]=o>>32&255,n[t+5]=o>>40&255,n[t+6]=o>>48&255,n[t+7]=o>>56&255}t+=u,l++}return t==i+1?i:(n[i]=255&u,t)}function A(e,r,n,t){var a,u=n,l=t+H;switch(r.type){case Q:var i={};if(i.value=0,l=O(e,r,u,l,i),null==l)return-1;if(0!=i.value)return 0;break;case T:for(r.index=1;;){var f=0;if(r.value=f,r.length=4,a=e(r),0>a){if(a==L)break;return a==z?0:-1}if(1>a)return-1;u[l]=1==r.value?1:0,l++,++r.index}break;default:for(r.index=1;;){if(r.buffer=u,r.buffer_idx=l+H,a=e(r),0>a){if(a==L)break;return a==z?0:-1}k(u,l,a),l+=H+a,++r.index}}return a=l-(t+H),0==a?0:k(u,t,a)}function M(e,r,n,t){for(var u,l=1;t>0;){if(H>t)return-1;if(u=a(n),n=n.slice(H),t-=H,u>t)return-1;if(r.index=l,r.value=n,r.length=u,0!=e(r))return-1;t-=u,n=n.slice(u),++l}return 0}function S(n,t,u){var l=a(u),i=t.type;if(0==l)return t.index=-1,t.value=null,t.length=0,n(t),0;switch(u=u.slice(H),i){case Q:var f=u[0];if(u=u.slice(1),--l,4==f){if(l%4!=0)return-1;for(var o=0;o<Math.floor(l/4);o++){var s=e(a(u.slice(4*o)));t.index=o+1,t.value=s,t.length=8,n(t)}}else{if(8!=f)return-1;if(l%8!=0)return-1;for(var o=0;o<Math.floor(l/8);o++){var c=a(u.slice(8*o)),v=a(u.slice(8*o+4)),s=r(c,v);t.index=o+1,t.value=s,t.length=8,n(t)}}break;case T:for(var o=0;l>o;o++){var s=u[o];t.index=o+1,t.value=s,t.length=8,n(t)}break;case V:case B:return M(n,t,u,l);default:return-1}return 0}function E(e,r,n,t,a,u){var l=0,i=0,f=t;t++,a--,0>a&&(f=null);for(var o=0;8>o;o++)0!=e[r+o]&&(i++,l|=1<<o,a>0&&(n[t]=e[r+o],++t,--a));return(7==i||6==i)&&u>0&&(i=8),8==i?u>0?8:10:(null!=f&&(n[f]=l),i+1)}function C(e,r,n,t,a){var u=a+7&-8;n[t]=255,n[t+1]=Math.floor(u/8)-1;for(var l=0;a>l;l++)n[t+l+2]=e[r+l];for(var l=0;u-a>l;l++)n[t+a+2+l]=0}function q(e,r,n,t){for(var a,u,l=new Array(8),i=0,f=0,o=0,s=0,c=e,v=n,p=e.length,g=1<<30,h=0;p>h;h+=8){var y,d=h+8-p;if(d>0){for(var b=0;8-d>b;b++)l[b]=c[r+b];for(var b=0;d>b;b++)l[7-b]=0;c=l,r=0}y=E(c,r,v,t,g,o),g-=y,10==y?(a=c,i=r,u=v,f=t,o=1):8==y&&o>0?(++o,256==o&&(g>=0&&C(a,i,u,f,2048),o=0)):o>0&&(g>=0&&C(a,i,u,f,8*o),o=0),r+=8,t+=y,s+=y}if(g>=0&&(1==o?C(a,i,u,f,8):o>1&&C(a,i,u,f,p-i),v.length>s))for(var h=s;h<v.length;h++)v[h]=0;return s}function R(e,r,n,t){for(var a=e,u=n,l=0,i=e.length,f=1<<30;i>0;){var o=a[r];if(--i,++r,255==o){var s;if(0>i)return-1;if(s=8*(a[r]+1),s+1>i)return-1;if(i-=s+1,++r,f>=s)for(var c=0;s>c;c++)u[t+c]=a[r+c];f-=s,t+=s,r+=s,l+=s}else for(var c=0;8>c;c++){var v=o>>>c&1;if(0!=v){if(0>i)return-1;f>0&&(u[t]=a[r],--f,++t),++r,--i}else f>0&&(u[t]=0,--f,++t);++l}}return l}var U={},I={},N={},D=0,P=1,Q=0,T=1,V=2,B=3,F=-1,L=-2,z=-3,G=128,H=4,J=2,K=2,W=64;return U.pack=function(e){var r=0,n=new Array,t=0;q(e,r,n,t);return n},U.unpack=function(e){var r=0,n=new Array,t=0;R(e,r,n,t);return n},U.createNew=function(u){function l(e,r,n,t,a){var u,l,i,f=new Object,o=n,s=n,c=J+e.maxn*K;f.ud=a,s=o+c,u=0,l=-1;for(var v=0;v<e.n;v++){var p=e.f[v],g=p.type,h=0,y=-1;f.tagname=p.name,f.tagid=p.tag,null!=p.st?f.subtype=O.type[p.st]:f.subtype=null,f.mainindex=p.key,f.extra=p.extra;if(0!=(g&G))f.type=g&~G,y=A(t,f,r,s);else switch(f.type=g,f.index=0,g){case Q:case T:if(f.value=0,f.length=8,f.buffer=r,f.buffer_idx=n,y=t(f),0>y){if(y==L)continue;return y==z?0:-1}if(4==y)f.value<32767?(h=2*(f.value+1),y=2):y=x(f.value,r,s,y);else{if(8!=y)return-1;y=w(f.value,r,s,y)}break;case B:case V:y=_(t,f,r,s)}if(0>y)return-1;if(y>0){var d,b;if(0==h&&(s+=y),d=o+J+K*u,b=p.tag-l-1,b>0){if(b=2*(b-1)+1,b>65535)return-1;r[d]=255&b,r[d+1]=b>>8&255,++u,d+=K}++u,r[d]=255&h,r[d+1]=h>>8&255,l=p.tag}}if(r[o]=255&u,r[o+1]=u>>8&255,i=s-(o+c),s=o+c,u!=e.maxn){for(var m=r.slice(s,s+i),k=0;k<m.length;k++)r[o+J+u*K+k]=m[k];r.length-(o+J+u*K+m.length);r.splice(o+J+u*K+m.length,r.length)}return J+u*K+i}function i(e){var r=e.ud;if(r.deep>=W)return alert("table is too deep"),-1;if(null==r.indata[e.tagname])return L;var t=null;if(e.index>0){if(e.tagname!=r.array_tag){r.array_tag=e.tagname;typeof r.indata[e.tagname];if("object"!=typeof r.indata[e.tagname])return r.array_index=0,L;if(0==r.indata[e.tagname].length||null==r.indata[e.tagname].length)return r.array_index=0,z}if(t=r.indata[e.tagname][e.index-1],null==t)return L}else t=r.indata[e.tagname];switch(e.type){case Q:var a,u;if(e.extra>0){var f=t;a=Math.floor(f*e.extra+.5)}else a=t;return u=n(a,31),0==u||-1==u?(e.value=a>>>0,4):(e.value=a,8);case T:return 1==t?e.value=1:0==t&&(e.value=0),4;case V:var o;if(e.extra)o=t;else{var s=t;o=utils.string2utf8(s)}var c=o.length;c>e.length&&(e.length=c);for(var v=0;v<o.length;v++)e.buffer[e.buffer_idx+v]=o[v];return c;case B:var p=new Object;p.st=e.subtype,p.deep=r.deep+1,p.indata=t;var g=l(e.subtype,e.buffer,e.buffer_idx,i,p);return 0>g?F:g;default:return alert("Invalid filed type "+e.type),F}}function f(n,u,l,i,f){var o,s,c,v,p=new Object,g=l;if(J>l)return-1;if(o=u.slice(0),c=t(o),o=o.slice(J),l-=J,c*K>l)return-1;s=o.slice(c*K),l-=c*K,p.ud=f,v=-1;for(var h=0;c>h;h++){var y=null,d=null,b=t(o.slice(h*K));if(++v,b&!0)v+=Math.floor(b/2);else{if(b=Math.floor(b/2)-1,y=s.slice(0),0>b){var k;if(H>l)return-1;if(k=a(s),k+H>l)return-1;s=s.slice(k+H),l-=k+H}if(d=m(n,v),null!=d)if(p.tagname=d.name,p.tagid=d.tag,p.type=d.type&~G,null!=d.st?p.subtype=O.type[d.st]:p.subtype=null,p.index=0,p.mainindex=d.key,p.extra=d.extra,0>b)if(0!=(d.type&G)){if(S(i,p,y))return-1}else switch(d.type){case Q:var k=a(y);if(4==k){var x=e(a(y.slice(H)));p.value=x,p.length=8,i(p)}else{if(8!=k)return-1;var w=a(y.slice(H)),_=a(y.slice(H+4)),x=r(w,_);p.value=x,p.length=8,i(p)}break;case V:case B:var k=a(y);if(p.value=y.slice(H),p.length=k,0!=i(p))return-1;break;default:return-1}else{if(d.type!=Q&&d.type!=T)return-1;p.value=b,p.length=8,i(p)}}}return g-l}function o(e){var r,n=e.ud;if(n.deep>=W&&alert("the table is too deep"),0!=e.index&&e.tagname!=n.array_tag&&(n.array_tag=e.tagname,n.result[e.tagname]=new Array,e.index<0))return 0;switch(e.type){case Q:if(e.extra){var t=e.value,a=t;r=a/e.extra}else r=e.value;break;case T:r=1==e.value?!0:0==e.value?!1:null;break;case V:for(var u=new Array,l=0;l<e.length;l++)u.push(e.value[l]);r=e.extra?u:utils.utf82string(u);break;case B:var i,s=new Object;if(s.deep=n.deep+1,s.array_index=0,s.array_tag=null,s.result=new Object,e.mainindex>=0){if(s.mainindex_tag=e.mainindex,i=f(e.subtype,e.value,e.length,o,s),0>i||i!=e.length)return i;r=s.result;break}if(s.mainindex_tag=-1,s.key_index=0,i=f(e.subtype,e.value,e.length,o,s),0>i)return F;if(i!=e.length)return i;r=s.result;break;default:alert("Invalid type")}return e.index>0?n.result[e.tagname][e.index-1]=r:n.result[e.tagname]=r,0}function s(e,r){var n=e.tcache[r];return(null===n||void 0===n)&&(n=b(e,r),e.tcache[r]=n),n}function c(e,r){var n=null,t=null;if("number"==typeof r){if(n=r,t=d(e,r),null===t)return null}else if(n=g(e,r),t=n,-1===n)return null;var a=y(e,n,D),u=y(e,n,P);return{ret1:t,request:a,response:u}}function h(e,r){var n=e.pcache[r];if(null===n||void 0===n){var t=c(e,r),a=t.ret1,u=t.request,l=t.response;if("number"==typeof r){a=r,r=a}n={request:u,response:l,pname:r,tag:a,name:t.ret1},e.pcache[r]=n,e.pcache[a]=n}return n}function k(e,r,n){return function(t){N.type=null,N.session=n;var a=e.proto.encode(e["package"],N);if(r){var u=e.proto.encode(r,t);return e.proto.pack(utils.arrayconcat(a,u))}return e.proto.pack(a)}}var j={};new Object,new Array;j.type_n=0,j.protocol_n=0,j.type=null,j.proto=null,j.tcache={},j.pcache={};var O=v(j,u,u.length);return null==O?null:(O.dump=function(){console.log("========== sproto dump =========="),p(this),console.log("=================================")},O.objlen=function(e,r){var n=null;if("string"==typeof e||"number"==typeof e){if(n=s(O,e),null==n)return null}else n=e;var t=new Object;return t.array_tag=null,t.deep=0,t.result=new Object,f(n,r,r.length,o,t)},O.encode=function(e,r){var n=new Object,t=null;if("string"==typeof e||"number"==typeof e){if(t=s(O,e),null==t)return null}else t=e;var a=2,u=new Array,f=0;for(n.st=t,n.tbl_index=a,n.indata=r;;){n.array_tag=null,n.array_index=0,n.deep=0,n.iter_index=a+1;var o=l(t,u,f,i,n);return 0>o?null:u}},O.decode=function(e,r){var n=null;if("string"==typeof e||"number"==typeof e){if(n=s(O,e),null==n)return null}else n=e;var t=r,a=r.length,u=new Object;u.array_tag=null,u.deep=0,u.result=new Object;var l=f(n,t,a,o,u);return 0>l?null:u.result},O.pack=function(e){return U.pack(e)},O.unpack=function(e){return U.unpack(e)},O.pencode=function(e,r){var n=O.encode(e,r);return null==n?null:O.pack(n)},O.pdecode=function(e,r){var n=O.unpack(r);return null==n?null:O.decode(e,n)},O.host=function(e){function r(e){e=e?e:"package",this.proto=O,this["package"]=s(O,e),this["package"]=this["package"]?this["package"]:"package",this.session={}}return r.prototype=I,new r(e)},I.attach=function(e){this.attachsp=e;var r=this;return function(n,t,a){var u=h(e,n);N.type=u.tag,N.session=a;var l=e.encode(r["package"],N);if(a&&(r.session[a]=u.response?u.response:!0),t){var i=e.encode(u.request,t);return e.pack(utils.arrayconcat(l,i))}return e.pack(l)}},I.dispatch=function(e){var r=this.proto,n=r.unpack(e);N.type=null,N.session=null,N=r.decode(this["package"],n);var t=r.objlen(this["package"],n),a=n.slice(t,n.length);if(N.type){var u,l=h(r,N.type);return l.request&&(u=r.decode(l.request,a)),N.session?{type:"REQUEST",pname:l.pname,result:u,responseFunc:k(this,l.response,N.session),session:N.session,name:l.name}:{type:"REQUEST",pname:l.pname,result:u,name:l.name}}r=this.attachsp;var i=N.session,f=this.session[i];if(f===!0)return{type:"RESPONSE",session:i};var u=r.decode(f,a);return{type:"RESPONSE",session:i,result:u}},O)},U}();window.Sproto=sproto;